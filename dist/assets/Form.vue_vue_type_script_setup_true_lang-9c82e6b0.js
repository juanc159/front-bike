import{Y as fe,bB as me,$ as ve,I as w,k as y,ar as re,G as B,ap as Ve,a1 as xe,bu as ye,p as t,J,F as H,K as Z,aK as be,bK as he,aU as Q,bD as ge,aQ as _e,b5 as pe,d as we,z as Ce,y as ke,o as $,c as Y,w as u,m as s,A as G,B as W,q as n,x as R,V as le,a as Fe,L as Se,b as Ie,C as Pe}from"./index-e5b1715d.js";import{_ as Ne}from"./Form.vue_vue_type_script_setup_true_lang-d49f0ac4.js";import{u as Te}from"./useCrudSaleStore-d5630ed5.js";import{r as D,i as Be}from"./validators-e0eb24cc.js";import{S as Re}from"./sweetalert2.all-09c1f25c.js";import{a as m,V as p}from"./VRow-0d53bcfe.js";import{V as X}from"./VSelect-25a384f7.js";import{a as De,e as Ue,b as ze,c as ae,f as Ae,g as Me,h as $e,V as ne}from"./VTextField-7b882186.js";import{f as Ge}from"./forwardRefs-9d31fcaa.js";import{V as He}from"./VTable-75e60859.js";import{V as Ee}from"./VCard-2bb6063b.js";import{V as oe}from"./VForm-d55aee7b.js";const Ke=fe()({name:"VTextarea",directives:{Intersect:me},inheritAttrs:!1,props:{autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...De(),...Ue()},emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,U){let{attrs:_,emit:F,slots:V}=U;const d=ve(e,"modelValue"),{isFocused:o,focus:C,blur:z}=ze(e),g=w(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),E=w(()=>{if(_.maxlength)return _.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function K(i,v){var f,h;!e.autofocus||!i||(h=(f=v[0].target)==null?void 0:f.focus)==null||h.call(f)}const S=y(),c=y(),A=y(""),k=y(),j=w(()=>o.value||e.persistentPlaceholder);function I(){var i;k.value!==document.activeElement&&((i=k.value)==null||i.focus()),o.value||C()}function P(i){I(),F("click:control",i)}function M(i){F("mousedown:control",i)}function r(i){i.stopPropagation(),I(),Q(()=>{d.value="",ge(e["onClick:clear"],i)})}function l(i){var f;const v=i.target;if(d.value=v.value,(f=e.modelModifiers)!=null&&f.trim){const h=[v.selectionStart,v.selectionEnd];Q(()=>{v.selectionStart=h[0],v.selectionEnd=h[1]})}}const a=y();function x(){e.autoGrow&&Q(()=>{if(!a.value||!c.value)return;const i=getComputedStyle(a.value),v=getComputedStyle(c.value.$el),f=parseFloat(i.getPropertyValue("--v-field-padding-top"))+parseFloat(i.getPropertyValue("--v-input-padding-top"))+parseFloat(i.getPropertyValue("--v-field-padding-bottom")),h=a.value.scrollHeight,q=parseFloat(i.lineHeight),L=Math.max(parseFloat(e.rows)*q+f,parseFloat(v.getPropertyValue("--v-input-control-height"))),O=parseFloat(e.maxRows)*q+f||1/0;A.value=_e(pe(h??0,L,O))})}re(x),B(d,x),B(()=>e.rows,x),B(()=>e.maxRows,x),B(()=>e.density,x);let b;return B(a,i=>{i?(b=new ResizeObserver(x),b.observe(a.value)):b==null||b.disconnect()}),Ve(()=>{b==null||b.disconnect()}),xe(()=>{const i=!!(V.counter||e.counter||e.counterValue),v=!!(i||V.details),[f,h]=ye(_),[{modelValue:q,...L}]=ae.filterProps(e),[O]=Ae(e);return t(ae,J({ref:S,modelValue:d.value,"onUpdate:modelValue":N=>d.value=N,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--flush-details":["plain","underlined"].includes(e.variant)},e.class],style:e.style},f,L,{focused:o.value}),{...V,default:N=>{let{isDisabled:T,isDirty:ee,isReadonly:ue,isValid:ie}=N;return t(Me,J({ref:c,style:{"--v-textarea-control-height":A.value},onClick:P,onMousedown:M,"onClick:clear":r,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},O,{active:j.value||ee.value,dirty:ee.value||e.dirty,disabled:T.value,focused:o.value,error:ie.value===!1}),{...V,default:se=>{let{props:{class:te,...de}}=se;return t(H,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),Z(t("textarea",J({ref:k,class:te,value:d.value,onInput:l,autofocus:e.autofocus,readonly:ue.value,disabled:T.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:I,onBlur:z},de,h),null),[[be("intersect"),{handler:K},null,{once:!0}]]),e.autoGrow&&Z(t("textarea",{class:[te,"v-textarea__sizer"],"onUpdate:modelValue":ce=>d.value=ce,ref:a,readonly:!0,"aria-hidden":"true"},null),[[he,d.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?N=>{var T;return t(H,null,[(T=V.details)==null?void 0:T.call(V,N),i&&t(H,null,[t("span",null,null),t($e,{active:e.persistentCounter||o.value,value:g.value,max:E.value},V.counter)])])}:void 0})}),Ge({},S,c,k)}}),je={class:"col-md-6 d-flex justify-content-end"},qe=s("br",null,null,-1),Le=s("thead",null,[s("tr",null,[s("th",null," Tercero "),s("th",null," Monto "),s("th",null," AcciÃ³n ")])],-1),Oe=s("td",null,[s("b",null," Total")],-1),Je=s("td",null,[s("b",null," Utilidades")],-1),Qe={class:"ml-5 mr-5 mb-5 mt-5"},Ye=s("h3",{class:"text-left"},"Ingreso Del Vehiculo",-1),st=we({__name:"Form",props:{userId:{type:Number,default:null,required:!1}},setup(e){const U=e,_=y(),F=y(),V=Ce(),d=Te(),{formulario:o,inventories:C,thirds:z}=ke(d),g=y([]),E=[{value:1,title:"Si"},{value:0,title:"No"}],K=y([]),S=async r=>{var l;d.typeAction=r,K.value=[],g.value=[],await((l=_.value)==null?void 0:l.resetValidation()),r!="back"&&d.keyList++},c=y({id:null,amount:null}),A=async()=>{var l;const r=await((l=F.value)==null?void 0:l.validate());if(r!=null&&r.valid){const a=z.value.find(x=>x.id==c.value.id);a&&(o.value.thirds.push({id:a.id,name:a.name,amount:c.value.amount}),c.value={id:null,amount:null})}},k=r=>{o.value.thirds=o.value.thirds.filter(l=>l.id!=r)},j=async()=>{var l;o.value.company_id=V.company.id,o.value.total=P.value,o.value.utilities=M.value;const r=await((l=_.value)==null?void 0:l.validate());if(r!=null&&r.valid){if(o.value.thirds.length==0)return Re.fire("Debe agregar almenos un tercero"),!1;const a=await d.fetchSave();a.status===200&&S("list"),a.status===422&&(g.value=a.error)}},I=w(()=>{const r=C.value.find(l=>l.id==o.value.inventory_id);return(r==null?void 0:r.purchaseValue)??0});w(()=>{const r=C.value.find(l=>l.id==o.value.inventory_id);return(r==null?void 0:r.saleValue)??0});const P=w(()=>o.value.thirds.reduce((r,l)=>Number(r)+Number(l.amount),0)),M=w(()=>{const r=C.value.find(l=>l.id==o.value.inventory_id);return!o.value.price_vehicle||!o.value.inventory_id?0:Number(o.value.price_vehicle??0)-(Number((r==null?void 0:r.purchaseValue)??0)+Number(P.value??0))});return re(async()=>{await d.fetchDataForm(),U.userId&&await d.fetchInfo(U.userId)}),(r,l)=>($(),Y("div",null,[t(p,null,{default:u(()=>[t(m,{cols:"12"},{default:u(()=>[s("div",je,[t(G,{color:"secondary",onClick:l[0]||(l[0]=a=>S("back"))},{default:u(()=>[W(" Atras ")]),_:1})])]),_:1})]),_:1}),t(n(oe),{ref_key:"formValidation",ref:_,"lazy-validation":""},{default:u(()=>[t(p,null,{default:u(()=>[t(m,{cols:"12",md:"4"},{default:u(()=>[t(X,{clearable:"",modelValue:n(o).inventory_id,"onUpdate:modelValue":[l[1]||(l[1]=a=>n(o).inventory_id=a),l[2]||(l[2]=a=>n(g).inventory_id="")],"item-title":"reference","item-value":"id",items:n(C),rules:[n(D)],"error-messages":n(g).inventory_id,label:"Inventario"},null,8,["modelValue","items","rules","error-messages"]),s("div",null,[s("b",null,"Valor Compra: "+R(n(I)),1),W(),qe])]),_:1}),t(m,{cols:"12",md:"8"},{default:u(()=>[t(n(oe),{ref_key:"formThirdValidation",ref:F,"lazy-validation":""},{default:u(()=>[t(p,null,{default:u(()=>[t(m,{cols:"12",md:"4"},{default:u(()=>[t(X,{rules:[n(D)],clearable:"",modelValue:n(c).id,"onUpdate:modelValue":l[3]||(l[3]=a=>n(c).id=a),"item-title":"name","item-value":"id",items:n(z),label:"Tercero"},null,8,["rules","modelValue","items"])]),_:1}),t(m,{cols:"12",md:"3"},{default:u(()=>[t(ne,{rules:[n(D),n(Be)],modelValue:n(c).amount,"onUpdate:modelValue":l[4]||(l[4]=a=>n(c).amount=a),label:"Monto"},null,8,["rules","modelValue"])]),_:1}),t(m,{cols:"12",md:"1"},{default:u(()=>[t(G,{size:"40",onClick:l[5]||(l[5]=a=>A()),flat:"",icon:"",color:"primary"},{default:u(()=>[t(le,{icon:"tabler-plus"})]),_:1})]),_:1}),t(m,{cols:"12",md:"3"},{default:u(()=>[t(ne,{modelValue:n(o).price_vehicle,"onUpdate:modelValue":l[6]||(l[6]=a=>n(o).price_vehicle=a),label:"Precio De Venta"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),t(p,null,{default:u(()=>[t(m,{cols:"12",md:"4"},{default:u(()=>[t(X,{rules:[n(D)],clearable:"",modelValue:n(o).barter,"onUpdate:modelValue":l[7]||(l[7]=a=>n(o).barter=a),items:E,label:"Permuta"},null,8,["rules","modelValue"])]),_:1}),t(m,{cols:"12",md:"4"},{default:u(()=>[t(Ke,{clearable:"",modelValue:n(o).description,"onUpdate:modelValue":l[8]||(l[8]=a=>n(o).description=a),rules:[n(D)],"error-messages":n(g).description,label:"Descripcion",onKeypress:l[9]||(l[9]=a=>n(g).description="")},null,8,["modelValue","rules","error-messages"])]),_:1}),t(m,{cols:"12",md:"4"},{default:u(()=>[t(He,{class:"text-no-wrap"},{default:u(()=>[Le,s("tbody",null,[($(!0),Y(H,null,Fe(n(o).thirds,(a,x)=>($(),Y("tr",{key:x},[s("td",null,R(a.name),1),s("td",null,R(a.amount),1),s("td",null,[t(G,{onClick:b=>k(a.id),flat:"",icon:"",color:"error",size:"40"},{default:u(()=>[t(le,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128)),s("tr",null,[Oe,s("td",null,R(n(P)),1)]),s("tr",null,[Je,s("td",null,R(n(M)),1)])])]),_:1})]),_:1})]),_:1}),t(p),t(p,null,{default:u(()=>[t(m,{cols:"12 d-flex justify-content-center"},{default:u(()=>[Z(t(G,{color:"primary",onClick:j},{default:u(()=>[W(" Guardar ")]),_:1},512),[[Se,n(o).barter==0]])]),_:1})]),_:1}),t(p,null,{default:u(()=>[n(o).barter==1?($(),Ie(m,{key:0,sm:"12"},{default:u(()=>[t(Ee,null,{default:u(()=>[s("div",Qe,[Ye,t(Ne,{onExecuteAction:l[10]||(l[10]=a=>n(o).barter=0),"btn-back":!1})])]),_:1})]),_:1})):Pe("",!0)]),_:1})]),_:1},512)]))}});export{st as _};
