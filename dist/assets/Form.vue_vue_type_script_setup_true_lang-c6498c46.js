import{Y as ve,bB as Ve,$ as xe,I as w,k as p,ar as ie,G as T,ap as pe,a1 as ye,bu as be,p as l,J as Q,F as H,K as ee,aK as he,bK as ge,aU as Y,bD as _e,aQ as we,b5 as Ce,d as ke,z as Fe,y as Se,o as M,c as W,w as u,m as s,V as E,E as X,q as a,x as R,A as ae,a as Ie,L as Ne,b as Pe,B as Be}from"./index-333f41b8.js";import{_ as Te}from"./Form.vue_vue_type_script_setup_true_lang-86870e68.js";import{u as Re}from"./useCrudSaleStore-4d17b906.js";import{r as A,n as G,v as ne}from"./validators-da167dd6.js";import{S as Ae}from"./sweetalert2.all-689f8ffb.js";import{a as m,V as _}from"./VRow-d2a2c669.js";import{V as Z}from"./VSelect-026de29d.js";import{a as De,e as Ue,b as $e,c as oe,f as ze,g as Me,h as Ee,V as re}from"./VTextField-e0c3ad65.js";import{f as Ge}from"./forwardRefs-9d31fcaa.js";import{V as He}from"./VTable-3c216502.js";import{V as Ke}from"./VCard-faba0bf7.js";import{V as ue}from"./VForm-fdf9fdaa.js";const je=ve()({name:"VTextarea",directives:{Intersect:Ve},inheritAttrs:!1,props:{autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...De(),...Ue()},emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,D){let{attrs:g,emit:F,slots:V}=D;const d=xe(e,"modelValue"),{isFocused:o,focus:C,blur:U}=$e(e),h=w(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),K=w(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function j(i,v){var f,b;!e.autofocus||!i||(b=(f=v[0].target)==null?void 0:f.focus)==null||b.call(f)}const S=p(),c=p(),$=p(""),k=p(),q=w(()=>o.value||e.persistentPlaceholder);function I(){var i;k.value!==document.activeElement&&((i=k.value)==null||i.focus()),o.value||C()}function N(i){I(),F("click:control",i)}function z(i){F("mousedown:control",i)}function r(i){i.stopPropagation(),I(),Y(()=>{d.value="",_e(e["onClick:clear"],i)})}function t(i){var f;const v=i.target;if(d.value=v.value,(f=e.modelModifiers)!=null&&f.trim){const b=[v.selectionStart,v.selectionEnd];Y(()=>{v.selectionStart=b[0],v.selectionEnd=b[1]})}}const n=p();function x(){e.autoGrow&&Y(()=>{if(!n.value||!c.value)return;const i=getComputedStyle(n.value),v=getComputedStyle(c.value.$el),f=parseFloat(i.getPropertyValue("--v-field-padding-top"))+parseFloat(i.getPropertyValue("--v-input-padding-top"))+parseFloat(i.getPropertyValue("--v-field-padding-bottom")),b=n.value.scrollHeight,L=parseFloat(i.lineHeight),O=Math.max(parseFloat(e.rows)*L+f,parseFloat(v.getPropertyValue("--v-input-control-height"))),J=parseFloat(e.maxRows)*L+f||1/0;$.value=we(Ce(b??0,O,J))})}ie(x),T(d,x),T(()=>e.rows,x),T(()=>e.maxRows,x),T(()=>e.density,x);let y;return T(n,i=>{i?(y=new ResizeObserver(x),y.observe(n.value)):y==null||y.disconnect()}),pe(()=>{y==null||y.disconnect()}),ye(()=>{const i=!!(V.counter||e.counter||e.counterValue),v=!!(i||V.details),[f,b]=be(g),[{modelValue:L,...O}]=oe.filterProps(e),[J]=ze(e);return l(oe,Q({ref:S,modelValue:d.value,"onUpdate:modelValue":P=>d.value=P,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--flush-details":["plain","underlined"].includes(e.variant)},e.class],style:e.style},f,O,{focused:o.value}),{...V,default:P=>{let{isDisabled:B,isDirty:te,isReadonly:se,isValid:de}=P;return l(Me,Q({ref:c,style:{"--v-textarea-control-height":$.value},onClick:N,onMousedown:z,"onClick:clear":r,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},J,{active:q.value||te.value,dirty:te.value||e.dirty,disabled:B.value,focused:o.value,error:de.value===!1}),{...V,default:ce=>{let{props:{class:le,...fe}}=ce;return l(H,null,[e.prefix&&l("span",{class:"v-text-field__prefix"},[e.prefix]),ee(l("textarea",Q({ref:k,class:le,value:d.value,onInput:t,autofocus:e.autofocus,readonly:se.value,disabled:B.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:I,onBlur:U},fe,b),null),[[he("intersect"),{handler:j},null,{once:!0}]]),e.autoGrow&&ee(l("textarea",{class:[le,"v-textarea__sizer"],"onUpdate:modelValue":me=>d.value=me,ref:n,readonly:!0,"aria-hidden":"true"},null),[[ge,d.value]]),e.suffix&&l("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?P=>{var B;return l(H,null,[(B=V.details)==null?void 0:B.call(V,P),i&&l(H,null,[l("span",null,null),l(Ee,{active:e.persistentCounter||o.value,value:h.value,max:K.value},V.counter)])])}:void 0})}),Ge({},S,c,k)}}),qe={class:"col-md-6 d-flex justify-content-end"},Le=s("br",null,null,-1),Oe=s("thead",null,[s("tr",null,[s("th",null," Tercero "),s("th",null," Monto "),s("th",null," AcciÃ³n ")])],-1),Je=s("td",null,[s("b",null," Total")],-1),Qe=s("td",null,[s("b",null," Utilidades")],-1),Ye={class:"ml-5 mr-5 mb-5 mt-5"},We=s("h3",{class:"text-left"},"Ingreso Del Vehiculo",-1),dt=ke({__name:"Form",props:{userId:{type:Number,default:null,required:!1}},setup(e){const D=e,g=p(),F=p(),V=Fe(),d=Re(),{formulario:o,inventories:C,thirds:U}=Se(d),h=p([]),K=[{value:1,title:"Si"},{value:0,title:"No"}],j=p([]),S=async r=>{var t;d.typeAction=r,j.value=[],h.value=[],await((t=g.value)==null?void 0:t.resetValidation()),r!="back"&&d.keyList++},c=p({id:null,amount:null}),$=async()=>{var t;const r=await((t=F.value)==null?void 0:t.validate());if(r!=null&&r.valid){c.value.amount=c.value.amount.replaceAll(".","");const n=U.value.find(x=>x.id==c.value.id);n&&(o.value.thirds.push({id:n.id,name:n.name,amount:c.value.amount}),c.value={id:null,amount:null})}},k=r=>{o.value.thirds=o.value.thirds.filter(t=>t.id!=r)},q=async()=>{var t;o.value.company_id=V.company.id,o.value.total=N.value,o.value.utilities=z.value;const r=await((t=g.value)==null?void 0:t.validate());if(r!=null&&r.valid){if(o.value.price_vehicle=o.value.price_vehicle.replaceAll(".",""),o.value.thirds.length==0)return Ae.fire("Debe agregar almenos un tercero"),!1;const n=await d.fetchSave();n.status===200&&S("list"),n.status===422&&(h.value=n.error)}},I=w(()=>{const r=C.value.find(t=>t.id==o.value.inventory_id);return(r==null?void 0:r.purchaseValue)??0});w(()=>{const r=C.value.find(t=>t.id==o.value.inventory_id);return(r==null?void 0:r.saleValue)??0});const N=w(()=>o.value.thirds.reduce((r,t)=>Number(r)+Number(t.amount),0)),z=w(()=>{const r=C.value.find(n=>n.id==o.value.inventory_id),t=String(o.value.price_vehicle).replaceAll(".","");return console.log(t),!t||!o.value.inventory_id?0:Number(t??0)-(Number((r==null?void 0:r.purchaseValue)??0)+Number(N.value??0))});return ie(async()=>{await d.fetchDataForm(),D.userId&&await d.fetchInfo(D.userId)}),(r,t)=>(M(),W("div",null,[l(_,null,{default:u(()=>[l(m,{cols:"12"},{default:u(()=>[s("div",qe,[l(E,{color:"secondary",onClick:t[0]||(t[0]=n=>S("back"))},{default:u(()=>[X(" Atras ")]),_:1})])]),_:1})]),_:1}),l(a(ue),{ref_key:"formValidation",ref:g,"lazy-validation":""},{default:u(()=>[l(_,null,{default:u(()=>[l(m,{cols:"12",md:"4"},{default:u(()=>[l(Z,{clearable:"",modelValue:a(o).inventory_id,"onUpdate:modelValue":[t[1]||(t[1]=n=>a(o).inventory_id=n),t[2]||(t[2]=n=>a(h).inventory_id="")],"item-title":"reference","item-value":"id",items:a(C),rules:[a(A)],"error-messages":a(h).inventory_id,label:"Inventario"},null,8,["modelValue","items","rules","error-messages"]),s("div",null,[s("b",null,"Valor Compra: "+R(a(G)(a(I))),1),X(),Le])]),_:1}),l(m,{cols:"12",md:"8"},{default:u(()=>[l(a(ue),{ref_key:"formThirdValidation",ref:F,"lazy-validation":""},{default:u(()=>[l(_,null,{default:u(()=>[l(m,{cols:"12",md:"4"},{default:u(()=>[l(Z,{rules:[a(A)],clearable:"",modelValue:a(c).id,"onUpdate:modelValue":t[3]||(t[3]=n=>a(c).id=n),"item-title":"name","item-value":"id",items:a(U),label:"Tercero"},null,8,["rules","modelValue","items"])]),_:1}),l(m,{cols:"12",md:"3"},{default:u(()=>[l(re,{rules:[a(A)],modelValue:a(c).amount,"onUpdate:modelValue":t[4]||(t[4]=n=>a(c).amount=n),label:"Monto",onBlur:t[5]||(t[5]=n=>a(c).amount=a(ne)(a(c).amount))},null,8,["rules","modelValue"])]),_:1}),l(m,{cols:"12",md:"1"},{default:u(()=>[l(E,{size:"40",onClick:t[6]||(t[6]=n=>$()),flat:"",icon:"",color:"primary"},{default:u(()=>[l(ae,{icon:"tabler-plus"})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:u(()=>[l(re,{modelValue:a(o).price_vehicle,"onUpdate:modelValue":t[7]||(t[7]=n=>a(o).price_vehicle=n),label:"Precio De Venta",onBlur:t[8]||(t[8]=n=>a(o).price_vehicle=a(ne)(a(o).price_vehicle))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),l(_,null,{default:u(()=>[l(m,{cols:"12",md:"4"},{default:u(()=>[l(Z,{rules:[a(A)],clearable:"",modelValue:a(o).barter,"onUpdate:modelValue":t[9]||(t[9]=n=>a(o).barter=n),items:K,label:"Permuta"},null,8,["rules","modelValue"])]),_:1}),l(m,{cols:"12",md:"4"},{default:u(()=>[l(je,{clearable:"",modelValue:a(o).description,"onUpdate:modelValue":t[10]||(t[10]=n=>a(o).description=n),rules:[a(A)],"error-messages":a(h).description,label:"Descripcion",onKeypress:t[11]||(t[11]=n=>a(h).description="")},null,8,["modelValue","rules","error-messages"])]),_:1}),l(m,{cols:"12",md:"4"},{default:u(()=>[l(He,{class:"text-no-wrap"},{default:u(()=>[Oe,s("tbody",null,[(M(!0),W(H,null,Ie(a(o).thirds,(n,x)=>(M(),W("tr",{key:x},[s("td",null,R(n.name),1),s("td",null,R(a(G)(n.amount)),1),s("td",null,[l(E,{onClick:y=>k(n.id),flat:"",icon:"",color:"error",size:"40"},{default:u(()=>[l(ae,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128)),s("tr",null,[Je,s("td",null,R(a(G)(a(N))),1)]),s("tr",null,[Qe,s("td",null,R(a(G)(a(z))),1)])])]),_:1})]),_:1})]),_:1}),l(_),l(_,null,{default:u(()=>[l(m,{cols:"12 d-flex justify-content-center"},{default:u(()=>[ee(l(E,{color:"primary",onClick:q},{default:u(()=>[X(" Guardar ")]),_:1},512),[[Ne,a(o).barter==0]])]),_:1})]),_:1}),l(_,null,{default:u(()=>[a(o).barter==1?(M(),Pe(m,{key:0,sm:"12"},{default:u(()=>[l(Ke,null,{default:u(()=>[s("div",Ye,[We,l(Te,{onExecuteAction:t[12]||(t[12]=n=>a(o).barter=0),"btn-back":!1})])]),_:1})]),_:1})):Be("",!0)]),_:1})]),_:1},512)]))}});export{dt as _};
