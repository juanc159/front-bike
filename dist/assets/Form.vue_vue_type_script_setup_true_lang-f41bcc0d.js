import{u as q,V as M}from"./VFileInput-394659a3.js";import{e as O,r as p,g as E,a4 as P,s as R,q as G,y as L,o as $,c as Q,d as a,w as o,B as n,a as U,E as V,b as v,A as m,k as e,Q as d,$ as F,h as H,V as I,j as J}from"./index-5157f066.js";import{V as f}from"./VTextField-f6b14139.js";import{V as W}from"./VSelect-6157aeab.js";import{V as X}from"./VTextarea-a446079a.js";import{V as C}from"./VTooltip-dc7d67d8.js";import{V as Y}from"./VDataTable-dd0cef76.js";import{V as S}from"./VForm-8fa3c58d.js";const Z={class:"col-md-6 d-flex justify-content-end"},h=U("h2",null,"Imagenes",-1),de=O({__name:"Form",props:{userId:{type:Number,default:null,required:!1}},setup(w){const b=w,B=p([{value:1,title:"Si"},{value:0,title:"No"}]),y=p(),A=E(),c=P(),{formulario:t}=R(c),s=p([]),K=p([]),g=async u=>{var l;c.typeAction=u,K.value=[],s.value=[],await((l=y.value)==null?void 0:l.resetValidation()),u!="back"&&c.keyList++},N=async()=>{var l;t.value.company_id=A.company.id,t.value.price=String(t.value.price).replaceAll(".",""),t.value.offer=String(t.value.offer).replaceAll(".","");const u=await((l=y.value)==null?void 0:l.validate());if(u!=null&&u.valid){const r=await c.fetchSave();r.status===200&&g("list"),r.status===422&&(s.value=r.error)}};G(async()=>{b.userId&&await c.fetchInfo(b.userId)});const k=p(),T=[{title:"Orden",key:"order"},{title:"Imagen",key:"path"},{title:"Acciones",sortable:!1,key:"actions"}],i=p(q()),_=L(()=>t.value.files.filter(l=>l.delete!="delete").sort((l,r)=>l.order-r.order)),z=()=>{i.value.clearData(),i.value.order=null},D=async()=>{var l;const u=await((l=k.value)==null?void 0:l.validate());u!=null&&u.valid&&(t.value.files.push({file:i.value.imageFile,order:i.value.order,path:i.value.imageUrl,delete:null,id:null}),z())},j=u=>{t.value.files[u].id?t.value.files[u].delete="delete":t.value.files.splice(u,1)};return(u,l)=>($(),Q("div",null,[a(m,null,{default:o(()=>[a(n,{cols:"12"},{default:o(()=>[U("div",Z,[a(V,{color:"secondary",onClick:l[0]||(l[0]=r=>g("back"))},{default:o(()=>[v(" Atras ")]),_:1})])]),_:1})]),_:1}),a(e(S),{ref_key:"formValidation",ref:y,"lazy-validation":""},{default:o(()=>[a(m,null,{default:o(()=>[a(n,{cols:"12",md:"3"},{default:o(()=>[a(f,{clearable:"",modelValue:e(t).name,"onUpdate:modelValue":l[1]||(l[1]=r=>e(t).name=r),rules:[e(d)],autocomplete:"off","error-messages":e(s).name,label:"Nombre",onKeypress:l[2]||(l[2]=r=>e(s).name="")},null,8,["modelValue","rules","error-messages"])]),_:1}),a(n,{cols:"12",md:"3"},{default:o(()=>[a(f,{clearable:"",modelValue:e(t).model,"onUpdate:modelValue":l[3]||(l[3]=r=>e(t).model=r),rules:[e(d)],autocomplete:"off","error-messages":e(s).model,label:"Modelo",onKeypress:l[4]||(l[4]=r=>e(s).model="")},null,8,["modelValue","rules","error-messages"])]),_:1}),a(n,{cols:"12",md:"3"},{default:o(()=>[a(f,{maxlength:"4",clearable:"",modelValue:e(t).year,"onUpdate:modelValue":l[5]||(l[5]=r=>e(t).year=r),rules:[e(d)],autocomplete:"off","error-messages":e(s).year,label:"Año",onKeypress:l[6]||(l[6]=r=>e(s).year="")},null,8,["modelValue","rules","error-messages"])]),_:1}),a(n,{cols:"12",md:"3"},{default:o(()=>[a(f,{clearable:"",modelValue:e(t).price,"onUpdate:modelValue":l[7]||(l[7]=r=>e(t).price=r),onBlur:l[8]||(l[8]=r=>e(t).price=e(F)(e(t).price)),rules:[e(d)],autocomplete:"off","error-messages":e(s).price,label:"Precio",onKeypress:l[9]||(l[9]=r=>e(s).price="")},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1}),a(m,null,{default:o(()=>[a(n,{cols:"12",md:"4"},{default:o(()=>[a(W,{items:e(B),clearable:"",modelValue:e(t).barter,"onUpdate:modelValue":l[10]||(l[10]=r=>e(t).barter=r),rules:[e(d)],autocomplete:"off","error-messages":e(s).barter,label:"Se permite permutas",onKeypress:l[11]||(l[11]=r=>e(s).barter="")},null,8,["items","modelValue","rules","error-messages"])]),_:1}),a(n,{cols:"12",md:"4"},{default:o(()=>[a(f,{clearable:"",modelValue:e(t).offer,"onUpdate:modelValue":l[12]||(l[12]=r=>e(t).offer=r),onBlur:l[13]||(l[13]=r=>e(t).offer=e(F)(e(t).offer)),rules:[e(d)],autocomplete:"off","error-messages":e(s).offer,label:"Oferta",onKeypress:l[14]||(l[14]=r=>e(s).offer="")},null,8,["modelValue","rules","error-messages"])]),_:1}),a(n,{cols:"12",md:"4"},{default:o(()=>[a(f,{type:"number",clearable:"",modelValue:e(t).days,"onUpdate:modelValue":l[15]||(l[15]=r=>e(t).days=r),rules:[e(d)],autocomplete:"off","error-messages":e(s).days,label:"Dias",onKeypress:l[16]||(l[16]=r=>e(s).days="")},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1}),a(m,null,{default:o(()=>[a(n,{cols:"12"},{default:o(()=>[a(X,{clearable:"",modelValue:e(t).description,"onUpdate:modelValue":l[17]||(l[17]=r=>e(t).description=r),rules:[e(d)],autocomplete:"off","error-messages":e(s).description,label:"Descripción",onKeypress:l[18]||(l[18]=r=>e(s).description="")},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1},512),a(m,null,{default:o(()=>[a(n,{cols:"12",sm:"6"},{default:o(()=>[a(m,null,{default:o(()=>[a(n,null,{default:o(()=>[h]),_:1})]),_:1}),a(e(S),{ref_key:"formFileValidation",ref:k,"lazy-validation":""},{default:o(()=>[a(m,null,{default:o(()=>[a(n,{cols:"12",sm:"4"},{default:o(()=>[($(),H(M,{onChange:e(i).handleImageSelected,rules:[e(d)],key:e(i).key},null,8,["onChange","rules"]))]),_:1}),a(n,{cols:"12",sm:"4"},{default:o(()=>[a(f,{type:"number",clearable:"",modelValue:e(i).order,"onUpdate:modelValue":l[19]||(l[19]=r=>e(i).order=r),rules:[e(d)],label:"Order"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"12",sm:"4"},{default:o(()=>[a(V,{color:"primary",icon:"",size:"35",onClick:l[20]||(l[20]=r=>D())},{default:o(()=>[a(I,{icon:"tabler-plus"}),a(C,{activator:"parent",location:"top"},{default:o(()=>[v("Agregar Archivo")]),_:1})]),_:1})]),_:1})]),_:1}),a(m,null,{default:o(()=>[a(n,{cols:"12"},{default:o(()=>[a(e(Y),{headers:T,"items-per-page":"999",items:e(_)},{"item.path":o(({item:r,index:x})=>[a(J,{src:r.raw.path,cover:"","max-width":"200px","max-height":"200px",class:"my-2"},null,8,["src"])]),"item.actions":o(({item:r,index:x})=>[a(V,{size:"x-small",color:"error",variant:"text",icon:"",onClick:ee=>j(x)},{default:o(()=>[a(I,{size:"22",icon:"tabler-trash"}),a(C,{activator:"parent",location:"top"},{default:o(()=>[v("Borrar")]),_:1})]),_:2},1032,["onClick"])]),bottom:o(()=>[]),_:1},8,["items"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),a(m,null,{default:o(()=>[a(n,{cols:"12 d-flex justify-content-center"},{default:o(()=>[a(V,{color:"primary",onClick:N},{default:o(()=>[v(" Guardar ")]),_:1})]),_:1})]),_:1})]))}});export{de as _};
