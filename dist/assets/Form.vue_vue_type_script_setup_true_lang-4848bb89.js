import{e as P,r as f,g as R,s as H,y as _,q as Q,o as b,c as C,d as t,w as n,B as s,a as u,E as y,b as S,A as d,k as l,Q as v,t as p,Z as h,$ as I,V as D,K as Z,L as J,G as O,H as W,h as X,C as Y,l as ee,S as le}from"./index-5157f066.js";import{_ as te}from"./Form.vue_vue_type_script_setup_true_lang-4651f26e.js";import{u as ae}from"./useCrudSaleStore-eceee0d0.js";import{V as N}from"./VSelect-6157aeab.js";import{V as U}from"./VTextField-f6b14139.js";import{V as re}from"./VTextarea-a446079a.js";import{V as oe}from"./VTable-bba866c0.js";import{V as F}from"./VForm-8fa3c58d.js";const ne={class:"col-md-6 d-flex justify-content-end"},ue=u("br",null,null,-1),se=u("thead",null,[u("tr",null,[u("th",null," Tercero "),u("th",null," Monto "),u("th",null," AcciÃ³n ")])],-1),ie=u("td",null,[u("b",null," Total")],-1),de=u("td",null,[u("b",null," Utilidades")],-1),me={class:"ml-5 mr-5 mb-5 mt-5"},ce=u("h3",{class:"text-left"},"Ingreso Del Vehiculo",-1),ge=P({__name:"Form",props:{userId:{type:Number,default:null,required:!1}},setup(z){const T=z,k=f(),x=f(),M=R(),m=ae(),{formulario:r,inventories:V,thirds:$}=H(m),c=f([]),q=[{value:1,title:"Si"},{value:0,title:"No"}],E=f([]),A=async o=>{var e;m.typeAction=o,E.value=[],c.value=[],await((e=k.value)==null?void 0:e.resetValidation()),o!="back"&&m.keyList++},i=f({id:null,amount:null}),L=async()=>{var e;const o=await((e=x.value)==null?void 0:e.validate());if(o!=null&&o.valid){i.value.amount=i.value.amount.replaceAll(".","");const a=$.value.find(w=>w.id==i.value.id);a&&(r.value.thirds.push({id:a.id,name:a.name,amount:i.value.amount}),i.value={id:null,amount:null})}},j=o=>{r.value.thirds=r.value.thirds.filter(e=>e.id!=o)},G=async()=>{var e;r.value.company_id=M.company.id,r.value.total=g.value,r.value.utilities=B.value;const o=await((e=k.value)==null?void 0:e.validate());if(o!=null&&o.valid){if(r.value.price_vehicle=r.value.price_vehicle.replaceAll(".",""),r.value.thirds.length==0)return le.fire("Debe agregar almenos un tercero"),!1;const a=await m.fetchSave();a.status===200&&A("list"),a.status===422&&(c.value=a.error)}},K=_(()=>{const o=V.value.find(e=>e.id==r.value.inventory_id);return(o==null?void 0:o.purchaseValue)??0});_(()=>{const o=V.value.find(e=>e.id==r.value.inventory_id);return(o==null?void 0:o.saleValue)??0});const g=_(()=>r.value.thirds.reduce((o,e)=>Number(o)+Number(e.amount),0)),B=_(()=>{const o=V.value.find(a=>a.id==r.value.inventory_id),e=String(r.value.price_vehicle).replaceAll(".","");return console.log(e),!e||!r.value.inventory_id?0:Number(e??0)-(Number((o==null?void 0:o.purchaseValue)??0)+Number(g.value??0))});return Q(async()=>{await m.fetchDataForm(),T.userId&&await m.fetchInfo(T.userId)}),(o,e)=>(b(),C("div",null,[t(d,null,{default:n(()=>[t(s,{cols:"12"},{default:n(()=>[u("div",ne,[t(y,{color:"secondary",onClick:e[0]||(e[0]=a=>A("back"))},{default:n(()=>[S(" Atras ")]),_:1})])]),_:1})]),_:1}),t(l(F),{ref_key:"formValidation",ref:k,"lazy-validation":""},{default:n(()=>[t(d,null,{default:n(()=>[t(s,{cols:"12",md:"4"},{default:n(()=>[t(N,{clearable:"",modelValue:l(r).inventory_id,"onUpdate:modelValue":[e[1]||(e[1]=a=>l(r).inventory_id=a),e[2]||(e[2]=a=>l(c).inventory_id="")],"item-title":"reference","item-value":"id",items:l(V),rules:[l(v)],"error-messages":l(c).inventory_id,label:"Inventario"},null,8,["modelValue","items","rules","error-messages"]),u("div",null,[u("b",null,"Valor Compra: "+p(l(h)(l(K))),1),S(),ue])]),_:1}),t(s,{cols:"12",md:"8"},{default:n(()=>[t(l(F),{ref_key:"formThirdValidation",ref:x,"lazy-validation":""},{default:n(()=>[t(d,null,{default:n(()=>[t(s,{cols:"12",md:"4"},{default:n(()=>[t(N,{rules:[l(v)],clearable:"",modelValue:l(i).id,"onUpdate:modelValue":e[3]||(e[3]=a=>l(i).id=a),"item-title":"name","item-value":"id",items:l($),label:"Tercero"},null,8,["rules","modelValue","items"])]),_:1}),t(s,{cols:"12",md:"3"},{default:n(()=>[t(U,{rules:[l(v)],modelValue:l(i).amount,"onUpdate:modelValue":e[4]||(e[4]=a=>l(i).amount=a),label:"Monto",onBlur:e[5]||(e[5]=a=>l(i).amount=l(I)(l(i).amount))},null,8,["rules","modelValue"])]),_:1}),t(s,{cols:"12",md:"1"},{default:n(()=>[t(y,{size:"40",onClick:e[6]||(e[6]=a=>L()),flat:"",icon:"",color:"primary"},{default:n(()=>[t(D,{icon:"tabler-plus"})]),_:1})]),_:1}),t(s,{cols:"12",md:"3"},{default:n(()=>[t(U,{modelValue:l(r).price_vehicle,"onUpdate:modelValue":e[7]||(e[7]=a=>l(r).price_vehicle=a),label:"Precio De Venta",onBlur:e[8]||(e[8]=a=>l(r).price_vehicle=l(I)(l(r).price_vehicle))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),t(d,null,{default:n(()=>[t(s,{cols:"12",md:"4"},{default:n(()=>[t(N,{rules:[l(v)],clearable:"",modelValue:l(r).barter,"onUpdate:modelValue":e[9]||(e[9]=a=>l(r).barter=a),items:q,label:"Permuta"},null,8,["rules","modelValue"])]),_:1}),t(s,{cols:"12",md:"4"},{default:n(()=>[t(re,{clearable:"",modelValue:l(r).description,"onUpdate:modelValue":e[10]||(e[10]=a=>l(r).description=a),rules:[l(v)],"error-messages":l(c).description,label:"Descripcion",onKeypress:e[11]||(e[11]=a=>l(c).description="")},null,8,["modelValue","rules","error-messages"])]),_:1}),t(s,{cols:"12",md:"4"},{default:n(()=>[t(oe,{class:"text-no-wrap"},{default:n(()=>[se,u("tbody",null,[(b(!0),C(Z,null,J(l(r).thirds,(a,w)=>(b(),C("tr",{key:w},[u("td",null,p(a.name),1),u("td",null,p(l(h)(a.amount)),1),u("td",null,[t(y,{onClick:fe=>j(a.id),flat:"",icon:"",color:"error",size:"40"},{default:n(()=>[t(D,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128)),u("tr",null,[ie,u("td",null,p(l(h)(l(g))),1)]),u("tr",null,[de,u("td",null,p(l(h)(l(B))),1)])])]),_:1})]),_:1})]),_:1}),t(d),t(d,null,{default:n(()=>[t(s,{cols:"12 d-flex justify-content-center"},{default:n(()=>[O(t(y,{color:"primary",onClick:G},{default:n(()=>[S(" Guardar ")]),_:1},512),[[W,l(r).barter==0]])]),_:1})]),_:1}),t(d,null,{default:n(()=>[l(r).barter==1?(b(),X(s,{key:0,sm:"12"},{default:n(()=>[t(Y,null,{default:n(()=>[u("div",me,[ce,t(te,{onExecuteAction:e[12]||(e[12]=a=>l(r).barter=0),"btn-back":!1})])]),_:1})]),_:1})):ee("",!0)]),_:1})]),_:1},512)]))}});export{ge as _};
